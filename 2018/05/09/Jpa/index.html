<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!--<![endif]-->

<head>
  <title>SpringData Jpa | JasonTATam</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="JasonTATam">
    <meta name="author" content="JasonTATam">
    <meta name="description" content="be Strange,be Smart" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="JasonTATam" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="atom.xml">
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/" target="_BLANK" class="animsition-link">AAA</a></li>
                    
                        <li><a href="/atom.xml" target="_BLANK" class="animsition-link">BBB</a></li>
                    
                </ul>
            </li>
            
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/Spring/" class="animsition-link">Spring<small>(1)</small></a></li>
				    
				    <li><a href="/categories/dubbo/" class="animsition-link">dubbo<small>(2)</small></a></li>
				    
				</ul>
        	</li>
			
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="http://go.kieran.top/" class="animsition-link">Kieran</a></li>
                    
                    <li><a href="http://domain.com/" class="animsition-link">Name</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">JasonTATam</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2018-05-09T05:46:21.000Z" itemprop="datePublished">
          2018-05-09
      </time>
    
    
    | 
    <a href='/tags/Jpa/'>Jpa</a>
    
    
</span>
                <h1>SpringData Jpa</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<h4 id="SpringData-Jpa"><a href="#SpringData-Jpa" class="headerlink" title="SpringData Jpa"></a>SpringData Jpa</h4><ol>
<li><h5 id="SpringData-Jpa的环境搭建"><a href="#SpringData-Jpa的环境搭建" class="headerlink" title="SpringData Jpa的环境搭建"></a>SpringData Jpa的环境搭建</h5><ul>
<li>如果是Maven项目的话,添加以下依赖</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.data&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-data-jpa&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;1.9.0.RELEASE&lt;/version&gt;</span><br><span class="line">			&lt;!-- &lt;version&gt;1.10.5.RELEASE&lt;/version&gt; --&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>由于SpringData Jpa使用了动态代理(JDK&amp;Cglib),因此我们在DAO中只需提供接口即可实现与数据库进行交互.</p>
<a id="more"></a>
</li>
<li><p>Spring与Jpa 的整合(配置文件)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--因为Spring与Jpa的整合封装了entityManager.我们需要配置工厂,从工厂获取entityManager--&gt;</span><br><span class="line">&lt;bean id=&quot;entityManagerFactory&quot;</span><br><span class="line">		class=&quot;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&quot;&gt;</span><br><span class="line">&lt;!--注入连接池--&gt;</span><br><span class="line">		&lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;</span><br><span class="line">&lt;!--对持久化对象进行扫描.读取持久化对象中的主角--&gt;</span><br><span class="line">		&lt;property name=&quot;packagesToScan&quot; value=&quot;com.itheima.entity&quot; /&gt;</span><br><span class="line">		&lt;property name=&quot;persistenceProvider&quot;&gt;</span><br><span class="line">			&lt;bean class=&quot;org.hibernate.jpa.HibernatePersistenceProvider&quot; /&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">		&lt;!--JPA的供应商适配器--&gt;</span><br><span class="line">		&lt;property name=&quot;jpaVendorAdapter&quot;&gt;</span><br><span class="line">			&lt;bean class=&quot;org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter&quot;&gt;</span><br><span class="line">				&lt;property name=&quot;generateDdl&quot; value=&quot;false&quot; /&gt;</span><br><span class="line">				&lt;property name=&quot;database&quot; value=&quot;ORACLE&quot; /&gt;</span><br><span class="line">				&lt;property name=&quot;databasePlatform&quot; value=&quot;org.hibernate.dialect.Oracle10gDialect&quot; /&gt;</span><br><span class="line">				&lt;property name=&quot;showSql&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">			&lt;/bean&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">&lt;!--配置方言--&gt;</span><br><span class="line">		&lt;property name=&quot;jpaDialect&quot;&gt;</span><br><span class="line">			&lt;bean class=&quot;org.springframework.orm.jpa.vendor.HibernateJpaDialect&quot; /&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">		&lt;property name=&quot;jpaPropertyMap&quot;&gt;</span><br><span class="line">			&lt;map&gt;</span><br><span class="line">				&lt;entry key=&quot;hibernate.query.substitutions&quot; value=&quot;true 1, false 0&quot; /&gt;</span><br><span class="line">				&lt;entry key=&quot;hibernate.default_batch_fetch_size&quot; value=&quot;16&quot; /&gt;</span><br><span class="line">				&lt;entry key=&quot;hibernate.max_fetch_depth&quot; value=&quot;2&quot; /&gt;</span><br><span class="line">				&lt;entry key=&quot;hibernate.enable_lazy_load_no_trans&quot; value=&quot;true&quot;&gt;&lt;/entry&gt;</span><br><span class="line">				&lt;entry key=&quot;hibernate.generate_statistics&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">				&lt;entry key=&quot;hibernate.bytecode.use_reflection_optimizer&quot;</span><br><span class="line">					value=&quot;true&quot; /&gt;</span><br><span class="line">				&lt;entry key=&quot;hibernate.cache.use_second_level_cache&quot; value=&quot;false&quot; /&gt;</span><br><span class="line">				&lt;entry key=&quot;hibernate.cache.use_query_cache&quot; value=&quot;false&quot; /&gt;</span><br><span class="line">			&lt;/map&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>准备持久化对象(实体类)</p>
<p>​</p>
</li>
</ul>
</li>
</ul>
</li>
<li><h5 id="SpringData-Jpa入门-简单实用"><a href="#SpringData-Jpa入门-简单实用" class="headerlink" title="SpringData Jpa入门(简单实用)"></a>SpringData Jpa入门(简单实用)</h5><ul>
<li><p>2.1  首先创建Dao的接口</p>
<p>==这里的Dao接口不需要填写注解@Repository的原因是因为JpaRepository接口的实现类SimpleJpaRepository已经帮我们填写了==</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DeptDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Dept</span>,<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>2.2  根据ID查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptDao deptDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun</span> <span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(deptDao);</span><br><span class="line">        System.out.println(deptDao.getClass());</span><br><span class="line">        Dept dept = deptDao.findOne(<span class="string">"100"</span>);</span><br><span class="line">        System.out.println(dept);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>2.3 查询所有-findAll</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">      List&lt;Dept&gt; deptList =  deptDao.findAll();</span><br><span class="line">      <span class="keyword">for</span> (Dept dept : deptList) &#123;</span><br><span class="line">          System.out.println(dept);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>2.4 添加 - save</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">saveDept</span><span class="params">()</span></span>&#123;</span><br><span class="line">       Dept dept = <span class="keyword">new</span> Dept();</span><br><span class="line">       dept.setDeptName(<span class="string">"研发部"</span>);</span><br><span class="line">       Dept parent = <span class="keyword">new</span> Dept();</span><br><span class="line">       parent.setDeptId(<span class="string">"101"</span>);</span><br><span class="line">       dept.setDept(parent);</span><br><span class="line">       dept.setState(<span class="number">1</span>);</span><br><span class="line">       dept.setDeptId(<span class="string">"297e595a61da8d3e0161da8d43ba0000"</span>);</span><br><span class="line">       deptDao.save(dept);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>2.5 删除 - delete</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span>&#123;</span><br><span class="line">       Dept dept = <span class="keyword">new</span> Dept();</span><br><span class="line">       dept.setDeptId(<span class="string">"402829816256c9ad016256c9b3480000"</span>);</span><br><span class="line">       deptDao.delete(dept);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h5 id="注意-更新与保存使用的是同一个方法save-区分更新与保存-添加用户-的依据是-传入的对象是否有ID属性值并且该ID在数据库是否存在-如果有ID-数据库也存在该ID-该操作为更新-反之-则为保存-添加"><a href="#注意-更新与保存使用的是同一个方法save-区分更新与保存-添加用户-的依据是-传入的对象是否有ID属性值并且该ID在数据库是否存在-如果有ID-数据库也存在该ID-该操作为更新-反之-则为保存-添加" class="headerlink" title="==注意:更新与保存使用的是同一个方法save(),区分更新与保存(添加用户)的依据是,传入的对象是否有ID属性值并且该ID在数据库是否存在.如果有ID,数据库也存在该ID,该操作为更新;反之,则为保存(添加)=="></a><strong>==注意:更新与保存使用的是同一个方法save(),区分更新与保存(添加用户)的依据是,传入的对象是否有ID属性值并且该ID在数据库是否存在.如果有ID,数据库也存在该ID,该操作为更新;反之,则为保存(添加)==</strong></h5><ol>
<li><h5 id="SpringData-Jpa-源码及执行流程分析"><a href="#SpringData-Jpa-源码及执行流程分析" class="headerlink" title="SpringData Jpa(源码及执行流程分析)"></a>SpringData Jpa(源码及执行流程分析)</h5><p><img src="C:\Users\User\Pictures\SpringDataJpa 接口继承关系.png" alt="SpringDataJpa 接口继承关系"></p>
<ul>
<li><p>因为在SpringData Jpa 里面使用了动态代理的技术,所以我们只需要编写接口继承JpaRespository便可以使用基本的增删改差的操作.</p>
</li>
<li><p>3.1 在测试类中的findOne方法打上断点.</p>
</li>
<li><p>3.2 当断点通过findOne方法后,进入到JdkDynamicAopProxy(代理工厂中)为我们生成代理对象.</p>
</li>
<li><p>3.3 代理概念:关于代理,是会在程序运行的期间动态生成类的字节码;</p>
<p>​      代理作用:在原有的目标对象方法的基础上,添加代码;对原有的方法进行加强.</p>
<ul>
<li>Jave的两种代理方法:该两种技术的不同之处就是JDK中需要用到接口来生成代理对象,而Cglib则是通过继承来生成代理对象.因此使用了Cglib技术的被代理对象的类不能使用final;<ul>
<li>JDK(静态代理&amp;动态代理)</li>
<li>Cglibe代理</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><h5 id="SpringData-Jpa-进阶"><a href="#SpringData-Jpa-进阶" class="headerlink" title="SpringData Jpa (进阶)"></a>SpringData Jpa (进阶)</h5><ul>
<li><p><strong>4.1 分页的使用findAll(Pageable pageable)</strong></p>
<p>==这里需要注意的是:分页中的起始页数在JPA中规定是从0开始的,但页面中通常是会传1过来.因此在这里要处理一下==</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">page</span> <span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="comment">//分页查询,定义从第几页开始查询,显示多少条记录</span></span><br><span class="line">      <span class="keyword">int</span> start = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">int</span> size = <span class="number">5</span>;</span><br><span class="line">      Pageable pageable = <span class="keyword">new</span> PageRequest(start-<span class="number">1</span>,size);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//页面要显示的信息</span></span><br><span class="line">      Page&lt;Dept&gt; deptPage = deptDao.findAll(pageable);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//页面的总记录数</span></span><br><span class="line">      <span class="keyword">long</span> totalElements = deptPage.getTotalElements();</span><br><span class="line">      <span class="comment">//获取页面显示记录数的总页数</span></span><br><span class="line">      <span class="keyword">int</span> totalPages = deptPage.getTotalPages();</span><br><span class="line">      </span><br><span class="line">      System.out.println(totalElements);</span><br><span class="line">      System.out.println(totalPages);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>4.2 dao接口自定义方法</strong></p>
<ul>
<li>以下为官文文档中对自定义接口方法的说明</li>
<li>我们定义的方法需要按照指定的格式:==findBy+持久化对象中的属性并且为驼峰格式.==</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>Dao接口</p>
<p>==这里建议使用List集合来接收数据.如果查询所得的数据有多个,而接收数据的类型却不是List类型会报错.因此为了稳定,这里建议使用List集合类型来接收数据==</p>
<p>​</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DeptDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Dept</span>,<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line"><span class="comment">//1. 按照部门名称查询</span></span><br><span class="line">    <span class="function">List&lt;Dept&gt; <span class="title">findByDeptName</span><span class="params">(String deptName)</span></span>;</span><br><span class="line">    <span class="comment">//2. 按照部门名称和状态查询</span></span><br><span class="line">    <span class="function">List&lt;Dept&gt; <span class="title">findByDeptNameAndState</span><span class="params">(String deptName,Integer state)</span></span>;</span><br><span class="line">    <span class="comment">//3. 按照部门名称模糊查询</span></span><br><span class="line">    <span class="function">List&lt;Dept&gt; <span class="title">findByDeptNameLike</span><span class="params">(String deptName)</span></span>;</span><br></pre></td></tr></table></figure>
<p>  }</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">- Dao 接口测试类</span><br><span class="line"></span><br><span class="line">  ```java</span><br><span class="line">  <span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line">  <span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptTest2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Autowired</span></span><br><span class="line">      <span class="keyword">private</span> DeptDao deptDao;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//按照部门名称查询</span></span><br><span class="line">      <span class="meta">@Test</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByDeptName</span><span class="params">()</span></span>&#123;</span><br><span class="line">          List&lt;Dept&gt; deptList = deptDao.findByDeptName(<span class="string">"网络部"</span>);</span><br><span class="line">          <span class="keyword">for</span> (Dept dept : deptList) &#123;</span><br><span class="line">              System.out.println(dept);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//按照部门名称和状态查询</span></span><br><span class="line">      <span class="meta">@Test</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByDeptNameAndState</span><span class="params">()</span></span>&#123;</span><br><span class="line">          List&lt;Dept&gt; deptList = deptDao.findByDeptNameAndState(<span class="string">"市场部"</span>, <span class="number">1</span>);</span><br><span class="line">          System.out.println(deptList);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//按照部门名称模糊查询</span></span><br><span class="line">      <span class="meta">@Test</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByDeptNameLike</span><span class="params">()</span></span>&#123;</span><br><span class="line">          List&lt;Dept&gt; like = deptDao.findByDeptNameLike(<span class="string">"%总%"</span>);</span><br><span class="line">          <span class="keyword">for</span> (Dept dept : like) &#123;</span><br><span class="line">              System.out.println(dept);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>4.3 JPQL(Java Persist Query Language) Java 持久化查询语言–跟HQL差不多</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">```java</span><br><span class="line">@Query(value=&quot;from Dept where state =?2 and state =?2 deptName=?1&quot;,nativeQuery =false)</span><br><span class="line">List&lt;Dept&gt; findByCondition(String deptName,Integer state);</span><br></pre></td></tr></table></figure>
<p>  ==注意:这里占位符的索引从1开始,并且要与参数列表中的顺序一一对应.==</p>
<ul>
<li><p><strong>4.4 原生SQL语句</strong></p>
<ul>
<li><p>开启对原生SQL语句的支持</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query</span>(value=<span class="string">"select * from DEPT_P where DEPT_NAME=? and STATE=?"</span>,nativeQuery = <span class="keyword">true</span>)</span><br><span class="line">    <span class="function">List&lt;Dept&gt; <span class="title">findByCondition2</span><span class="params">(String deptName,Integer state)</span></span>;</span><br></pre></td></tr></table></figure>
<p>==注意:这里的占位符与参数列表必须一一对应.这里没有索引的定义了==</p>
<ul>
<li><p><strong>4.5JPQL语句之更新</strong></p>
<ul>
<li><p>执行更新操作前的准备</p>
<blockquote>
<p>1)JPQL更新,必须在接口方法上添加注解@Modifying,否则会报错:</p>
<p>Not supported for DML operations </p>
<p>2) JPQL更新,更新需要事务,需要在测试方法或接口方法上添加注解:@Transactional,否则会报错:</p>
<p>TransactionRequiredException:Executing an update/delete query</p>
<p>3)如果操作要反映到数据库,需要提交事务,需要在测试方法或接口方法上添加注解:</p>
<p>@Rollback(false) 代表在测试时提交事务.</p>
<p>@Rollback(false)     Committed transaction for test</p>
<p> @Rollback(true)       Rolled backtransaction for test</p>
<p>​</p>
</blockquote>
<p>​</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query</span>(value=<span class="string">"update Dept set deptName = ?1 where deptId= ?2"</span>,nativeQuery = <span class="keyword">false</span>)</span><br><span class="line">    <span class="meta">@Modifying</span></span><br><span class="line">    <span class="meta">@Rollback</span>(<span class="keyword">false</span>)</span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(String deptName,String deptId)</span></span>;</span><br></pre></td></tr></table></figure>
<p>​</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### 5. SpringData Jpa(条件查询)</span><br><span class="line"></span><br><span class="line">- 5.1 JpaSpecificationExecutor动态条件查询</span><br><span class="line"></span><br><span class="line">  &gt; - 问题:如果是使用dao接口自定义方法来进行条件查询的话,在某些情况下会两种情况,一种是该条件有值,另一种是该条件没有值为空.所以在为了应对这两种情况就需要在接口中定义两个方法了.如果条件越来越多,就意味着越来越麻烦了.</span><br><span class="line">  &gt;</span><br><span class="line">  &gt;   ​</span><br><span class="line">  &gt;</span><br><span class="line">  &gt; - 解决方法:使用JpaSpecificationExecutor动态条件查询接口.</span><br><span class="line">  &gt;</span><br><span class="line">  &gt; #####  </span><br><span class="line"></span><br><span class="line">  - 5.2 多条件测试</span><br><span class="line"></span><br><span class="line">    在这里需要用到一个接口,并且这个接口由我们自己来实现.</span><br><span class="line"></span><br><span class="line">    &gt; Specification&lt;T&gt;;</span><br><span class="line"></span><br><span class="line">    在这个接口需要重写一个方法</span><br><span class="line"></span><br><span class="line">    ```java</span><br><span class="line">    public Predicate toPredicate(Root&lt;Dept&gt;root,CriteriaQuery&lt;?&gt;query,CriteriaBuilder cb)&#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>5.3 参数的含义</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">Param</th>
<th style="text-align:center">mean</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">root</td>
<td style="text-align:center">通过root可以获取查询的属性对象</td>
</tr>
<tr>
<td style="text-align:center">query</td>
<td style="text-align:center">query对Criteria查询的支持</td>
</tr>
<tr>
<td style="text-align:center">cb</td>
<td style="text-align:center">cb条件构造器,构造条件</td>
</tr>
</tbody>
</table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">- <span class="number">5.4</span> 实现方法,并进行查询</span><br><span class="line"></span><br><span class="line">  ```java</span><br><span class="line">  	   <span class="meta">@Test</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="comment">//从页面传递数据过来</span></span><br><span class="line">          String deptName = <span class="string">"市场部"</span>;</span><br><span class="line">          Integer state = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">//实现接口specification</span></span><br><span class="line">          Specification&lt;Dept&gt; spec = <span class="keyword">new</span> Specification&lt;Dept&gt;() &#123;</span><br><span class="line"></span><br><span class="line">              <span class="comment">//实现specification接口中的方法</span></span><br><span class="line">              <span class="meta">@Override</span></span><br><span class="line">              <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Dept&gt; root, CriteriaQuery&lt;?&gt; criteriaQuery, CriteriaBuilder criteriaBuilder)</span> </span>&#123;</span><br><span class="line">                  <span class="comment">//定义一个Predicate集合</span></span><br><span class="line">                  List&lt;Predicate&gt; predicateList = <span class="keyword">new</span> ArrayList&lt;Predicate&gt;();</span><br><span class="line"></span><br><span class="line">                  <span class="comment">//通过root获取查询的对象属性</span></span><br><span class="line">                  <span class="keyword">if</span> (StringUtils.isNoneBlank(deptName)) &#123;</span><br><span class="line">                      Predicate p1 = criteriaBuilder.equal(root.get(<span class="string">"deptName"</span>).as(String.class), deptName);</span><br><span class="line">                      predicateList.add(p1);</span><br><span class="line">                  &#125;</span><br><span class="line"></span><br><span class="line">                  <span class="keyword">if</span> (state != <span class="keyword">null</span>) &#123;</span><br><span class="line">                      Predicate p2 = criteriaBuilder.equal(root.get(<span class="string">"state"</span>).as(Integer.class), state);</span><br><span class="line">                      predicateList.add(p2);</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="comment">//新建一个Predicate数组</span></span><br><span class="line">                  Predicate[] predicate = <span class="keyword">new</span> Predicate[predicateList.size()];</span><br><span class="line">                  <span class="comment">//将集合拼接成数组,因为criteriaBuilder.and()方法里面可以传递可变参数.也就是说数组也可以</span></span><br><span class="line">                  <span class="keyword">return</span> criteriaBuilder.and(predicateList.toArray(predicate));</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;;</span><br><span class="line">                  List&lt;Dept&gt; list = deptDao.findAll(spec);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">for</span> (Dept dept : list) &#123;</span><br><span class="line">              System.out.println(dept);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><code>`</code></p>
<p>  ​</p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="m-pagination col-md-8 col-md-offset-2 col-sm-24" role="pagination">
    
    <a class="pull-left" href="/2018/05/09/dubbo/" style="float: left;">
        ← dubbo(概述)
    </a>
    
    
    <a class="pull-right" href="/2018/05/09/hello-world/">
        Hello World →
    </a>
    
</nav>

        <div class="col-md-8 col-md-offset-2 col-sm-24"><script type="text/javascript">
  /**
   * 搜狐畅言
   */

  /*
  document.write('<div id="SOHUCS" sid="' + window.location.pathname.slice(1) + '" ></div>');

  window.onload = function () {
    (function () {
      var appid = 'cytXXXX';
      var conf = 'prod_xxxxxxxxxxxxxxxxx';
      var width = window.innerWidth || document.documentElement.clientWidth;
      var loadJs = function (d, a, id) {
        var c = document.getElementsByTagName("head")[0] || document.head || document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type", "text/javascript");
        b.setAttribute("charset", "UTF-8");
        b.setAttribute("src", d);
        if (id) {
          b.setAttribute("id", id);
        }
        if (typeof a === "function") {
          if (window.attachEvent) {
            b.onreadystatechange = function () {
              var e = b.readyState;
              if (e === "loaded" || e === "complete") {
                b.onreadystatechange = null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)
      };

      loadJs("https://changyan.sohu.com/upload/changyan.js", function () {
        window.changyan.api.config({
          appid: appid,
          conf: conf
        })
      });
    })();
  }
  */

</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By JasonTATam. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



      
</body>
</html>
